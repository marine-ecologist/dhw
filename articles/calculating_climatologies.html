<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Calculating Degree Heating Weeks • dhw</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><script src="../deps/MathJax-3.2.2/tex-chtml.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Calculating Degree Heating Weeks">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">dhw</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">0.0.2.9000</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><h6 class="dropdown-header" data-toc-skip>1. SST Metrics</h6></li>
    <li><a class="dropdown-item" href="../articles/calculating_climatologies.html">Calculating Degree Heating Weeks</a></li>
    <li><h6 class="dropdown-header" data-toc-skip>2. Reprocible Code</h6></li>
    <li><a class="dropdown-item" href="../articles/validating_climatologies.html">Validating DHW climatologies</a></li>
    <li><h6 class="dropdown-header" data-toc-skip>3. Extracting and visualising data</h6></li>
    <li><a class="dropdown-item" href="../articles/extracting_data.html">Downloading SST and spatial data</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch">
<li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul>
</li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Calculating Degree Heating Weeks</h1>
            
      

      <div class="d-none name"><code>calculating_climatologies.Rmd</code></div>
    </div>

    
    
<div class="section level3">
<h3 id="create-climatologies">Create Climatologies:<a class="anchor" aria-label="anchor" href="#create-climatologies"></a>
</h3>
<p>The main function <code>create_climatology(``)</code> takes an input
<code><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">terra::rast()</a></code> SST file. Included is an example a subset of
the NOAA CoralTemp for Lizard Island (145.4, -14.7):</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span>  <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://marine-ecologist.github.io/dhw/">dhw</a></span><span class="op">)</span></span>
<span><span class="co">#&gt;  library(dhw) dev v0.0.2.9000</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rspatial.org/" class="external-link">terra</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; terra 1.8.5</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Error in get(paste0(generic, ".", class), envir = get_method_env()) : </span></span>
<span><span class="co">#&gt;   object 'type_sum.accel' not found</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; ── <span style="font-weight: bold;">Attaching core tidyverse packages</span> ──────────────────────── tidyverse 2.0.0 ──</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">dplyr    </span> 1.1.4     <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">readr    </span> 2.1.5</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">forcats  </span> 1.0.0     <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">stringr  </span> 1.5.1</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">lubridate</span> 1.9.4     <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">tibble   </span> 3.2.1</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">purrr    </span> 1.0.2     <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">tidyr    </span> 1.3.1</span></span>
<span><span class="co">#&gt; ── <span style="font-weight: bold;">Conflicts</span> ────────────────────────────────────────── tidyverse_conflicts() ──</span></span>
<span><span class="co">#&gt; <span style="color: #BB0000;">✖</span> <span style="color: #0000BB;">tidyr</span>::<span style="color: #00BB00;">extract()</span> masks <span style="color: #0000BB;">terra</span>::extract()</span></span>
<span><span class="co">#&gt; <span style="color: #BB0000;">✖</span> <span style="color: #0000BB;">dplyr</span>::<span style="color: #00BB00;">filter()</span>  masks <span style="color: #0000BB;">stats</span>::filter()</span></span>
<span><span class="co">#&gt; <span style="color: #BB0000;">✖</span> <span style="color: #0000BB;">dplyr</span>::<span style="color: #00BB00;">lag()</span>     masks <span style="color: #0000BB;">stats</span>::lag()</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Use the conflicted package (<span style="color: #0000BB; font-style: italic;">&lt;http://conflicted.r-lib.org/&gt;</span>) to force all conflicts to become errors</span></span>
<span></span>
<span>  <span class="va">lizard_crw</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"extdata"</span>, <span class="st">"lizard_crw.tif"</span>, package<span class="op">=</span><span class="st">"dhw"</span><span class="op">)</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="va">lizard_crw</span></span>
<span><span class="co">#&gt; class       : SpatRaster </span></span>
<span><span class="co">#&gt; dimensions  : 1, 1, 14228  (nrow, ncol, nlyr)</span></span>
<span><span class="co">#&gt; resolution  : 0.05, 0.05  (x, y)</span></span>
<span><span class="co">#&gt; extent      : 145.4, 145.45, -14.7, -14.65  (xmin, xmax, ymin, ymax)</span></span>
<span><span class="co">#&gt; coord. ref. : lon/lat WGS 84 (EPSG:4326) </span></span>
<span><span class="co">#&gt; source      : lizard_crw.tif </span></span>
<span><span class="co">#&gt; names       :     analy~sst_1,     analy~sst_2,     analy~sst_3,     analy~sst_4,     analy~sst_5,     analy~sst_6, ... </span></span>
<span><span class="co">#&gt; min values  :           24.89,            25.2,           25.36,           25.27,           25.28,           24.75, ... </span></span>
<span><span class="co">#&gt; max values  :           24.89,            25.2,           25.36,           25.27,           25.28,           24.75, ... </span></span>
<span><span class="co">#&gt; unit        : degrees_Celsius, degrees_Celsius, degrees_Celsius, degrees_Celsius, degrees_Celsius, degrees_Celsius, ... </span></span>
<span><span class="co">#&gt; time        : 1985-06-01 12:00:00 to 2024-05-15 12:00:00 UTC</span></span></code></pre></div>
<p>To create climatologies, use <code>create_climatology</code>:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span>  </span>
<span>  <span class="va">lizard_climatology</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_climatology.html">create_climatology</a></span><span class="op">(</span><span class="va">lizard_crw</span><span class="op">)</span></span>
<span><span class="co">#&gt; --- create_climatology ---</span></span>
<span><span class="co">#&gt; 4.8e-06 secs  -  Processing Monthly Mean Climatology </span></span>
<span><span class="co">#&gt; 2.2 secs  -  Processing Daily Climatology </span></span>
<span><span class="co">#&gt; 2.4 secs  -  Processing SST Anomalies </span></span>
<span><span class="co">#&gt; 3 secs  -  Processing HotSpots (HS) </span></span>
<span><span class="co">#&gt; 3.3 secs  -  Processing Degree Heating Weeks (DHW) </span></span>
<span><span class="co">#&gt; 3.7 secs  -  Combining outputs</span></span></code></pre></div>
<p>which outputs a list of seven rasters, including sst (the original
input data), monthly maximum, mean monthly maximum, daily climatology,
anomalies, hotspots, and degree heating weeks:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">lizard_climatology</span><span class="op">)</span></span>
<span><span class="co">#&gt; List of 7</span></span>
<span><span class="co">#&gt;  $ sst        :S4 class 'SpatRaster' [package "terra"]</span></span>
<span><span class="co">#&gt;  $ mm         :S4 class 'SpatRaster' [package "terra"]</span></span>
<span><span class="co">#&gt;  $ mmm        :S4 class 'SpatRaster' [package "terra"]</span></span>
<span><span class="co">#&gt;  $ climatology:S4 class 'SpatRaster' [package "terra"]</span></span>
<span><span class="co">#&gt;  $ anomaly    :S4 class 'SpatRaster' [package "terra"]</span></span>
<span><span class="co">#&gt;  $ hotspots   :S4 class 'SpatRaster' [package "terra"]</span></span>
<span><span class="co">#&gt;  $ dhw        :S4 class 'SpatRaster' [package "terra"]</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="details">Details:<a class="anchor" aria-label="anchor" href="#details"></a>
</h3>
<p><code><a href="../reference/create_climatology.html">create_climatology()</a></code> is a wrapper around the following
functions:</p>
<ul>
<li><code><a href="../reference/calculate_monthly_mean.html">calculate_monthly_mean()</a></code></li>
<li><code><a href="../reference/calculate_maximum_monthly_mean.html">calculate_maximum_monthly_mean()</a></code></li>
<li><code><a href="../reference/calculate_daily_climatology.html">calculate_daily_climatology()</a></code></li>
<li><code><a href="../reference/calculate_hotspots.html">calculate_hotspots()</a></code></li>
<li><code><a href="../reference/calculate_dhw.html">calculate_dhw()</a></code></li>
</ul>
<div class="section level4">
<h4 id="calculate-monthly-mean">calculate monthly mean<a class="anchor" aria-label="anchor" href="#calculate-monthly-mean"></a>
</h4>
<p>the <code><a href="../reference/calculate_monthly_mean.html">calculate_monthly_mean()</a></code> function takes an input
raster SST file (for example the <code>lizard_crw</code> timeseries from
above) and returns a the monthly means: mm-Jan through to
mm-Dec. Following the methodology of Skirving et al (2020):</p>
<blockquote>
<p>The monthly mean (MM) climatology is a set of 12 SST values that
represent the average SST for each month calculated over the period 1985
to 2012, adjusted to 1988.2857 (being the average of the years used in
the original climatology, i.e., 1985–1990 and 1993). To achieve this,
the daily SST values in each month were averaged to produce 12 mean SST
values for each of the 28 years from 1985 to 2012. A least squares
linear regression was then applied to each month, e.g., the 28 values
for each of the Januaries (Y-values) were regressed against the years
(X-values), and the SST value corresponding to X= 1988.2857 was assigned
as the MM value for January for each 0.05 × 0.05 degree pixel
separately. This was repeated for each month until each pixel had a set
of 12 MM values, representing the MM climatology. This method maintained
a similar MM value to that of the original climatology while increasing
the number of years that contributed to the climatology. This was done
in order to provide consistency of interpretation throughout the various
versions of the heat stress products</p>
</blockquote>
<p>This function calculates the <strong>monthly mean climatology
(MM)</strong> for a given sea surface temperature (SST) dataset over a
specified baseline period (1985–2012). It first extracts the time
dimension from the input sst_file and filters the data to include only
the years 1985–2012. For each month (January to December), it subsets
the SST data corresponding to that month and applies a linear regression
to estimate the SST value adjusted to the year 1988.2857 (the average of
the baseline years). This is done by predicting the SST value for
1988.2857 using the regression model. The function outputs a terra::rast
object containing 12 layers, one for each month’s climatological mean
SST, with appropriate names and metadata assigned to the layers.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">lizard_crw_mm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/calculate_monthly_mean.html">calculate_monthly_mean</a></span><span class="op">(</span>sst_file <span class="op">=</span> <span class="va">lizard_crw</span><span class="op">)</span></span>
<span></span>
<span><span class="va">lizard_crw_mm</span></span>
<span><span class="co">#&gt; class       : SpatRaster </span></span>
<span><span class="co">#&gt; dimensions  : 1, 1, 12  (nrow, ncol, nlyr)</span></span>
<span><span class="co">#&gt; resolution  : 0.05, 0.05  (x, y)</span></span>
<span><span class="co">#&gt; extent      : 145.4, 145.45, -14.7, -14.65  (xmin, xmax, ymin, ymax)</span></span>
<span><span class="co">#&gt; coord. ref. : lon/lat WGS 84 (EPSG:4326) </span></span>
<span><span class="co">#&gt; source(s)   : memory</span></span>
<span><span class="co">#&gt; varnames    : mm-Jan </span></span>
<span><span class="co">#&gt;               mm-Feb </span></span>
<span><span class="co">#&gt;               mm-Mar </span></span>
<span><span class="co">#&gt;               ...</span></span>
<span><span class="co">#&gt; names       :   mm-Jan,   mm-Feb,   mm-Mar,   mm-Apr,   mm-May,   mm-Jun, ... </span></span>
<span><span class="co">#&gt; min values  : 28.50679, 28.65061, 28.01818, 27.12108, 25.83351, 24.45509, ... </span></span>
<span><span class="co">#&gt; max values  : 28.50679, 28.65061, 28.01818, 27.12108, 25.83351, 24.45509, ...</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="calculate-maximum-monthly-mean">calculate maximum monthly mean<a class="anchor" aria-label="anchor" href="#calculate-maximum-monthly-mean"></a>
</h4>
<p>the <code><a href="../reference/calculate_maximum_monthly_mean.html">calculate_maximum_monthly_mean()</a></code> function takes the
output from the monthly means above and returns a single value, the
maximum monthly mean. Following Skirving et al (2020):</p>
<blockquote>
<p>The Maximum Monthly Mean (MMM) climatology is the maximum of the 12
MM values for each satellite pixel.</p>
</blockquote>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">lizard_crw_mmm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/calculate_maximum_monthly_mean.html">calculate_maximum_monthly_mean</a></span><span class="op">(</span>mm <span class="op">=</span> <span class="va">lizard_crw_mm</span><span class="op">)</span></span>
<span></span>
<span><span class="va">lizard_crw_mmm</span></span>
<span><span class="co">#&gt; class       : SpatRaster </span></span>
<span><span class="co">#&gt; dimensions  : 1, 1, 1  (nrow, ncol, nlyr)</span></span>
<span><span class="co">#&gt; resolution  : 0.05, 0.05  (x, y)</span></span>
<span><span class="co">#&gt; extent      : 145.4, 145.45, -14.7, -14.65  (xmin, xmax, ymin, ymax)</span></span>
<span><span class="co">#&gt; coord. ref. : lon/lat WGS 84 (EPSG:4326) </span></span>
<span><span class="co">#&gt; source(s)   : memory</span></span>
<span><span class="co">#&gt; varname     : mmm_anom </span></span>
<span><span class="co">#&gt; name        :    lyr.1 </span></span>
<span><span class="co">#&gt; min value   : 28.65061 </span></span>
<span><span class="co">#&gt; max value   : 28.65061</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="calculate-daily-climatology">calculate daily climatology<a class="anchor" aria-label="anchor" href="#calculate-daily-climatology"></a>
</h4>
<p>the <code><a href="../reference/calculate_daily_climatology.html">calculate_daily_climatology()</a></code> function takes an
input raster SST file in <code><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">terra::rast()</a></code> format. Following
Skirving et al (2020):</p>
<blockquote>
<p>The daily climatologies (DC) are derived from the MM via a linear
interpolation. To achieve this, the MM value was assigned to the 15th
day of each corresponding month, with the individual days between these
dates being derived using a linear interpolation. </p>
</blockquote>
<p>The function generates a <strong>daily SST climatology</strong> from
a provided monthly mean climatology (mm) and an SST dataset (sst_file).
It first ensures the time dimension of sst_file is in Date format and
extracts the start and end dates. Monthly time values are generated, and
the monthly climatology is repeated across the time range and assigned
to the 15th day of each month. Using zoo::na.approx, the function
interpolates the monthly climatology to a daily resolution, aligning it
with the exact daily dates of sst_file. The result is a terra::rast
object with daily climatology values, named and time-aligned to the
input SST dataset.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">lizard_crw_climatology</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/calculate_daily_climatology.html">calculate_daily_climatology</a></span><span class="op">(</span>sst_file <span class="op">=</span> <span class="va">lizard_crw</span>, mm <span class="op">=</span> <span class="va">lizard_crw_mm</span><span class="op">)</span></span>
<span></span>
<span><span class="va">lizard_crw_climatology</span></span>
<span><span class="co">#&gt; class       : SpatRaster </span></span>
<span><span class="co">#&gt; dimensions  : 1, 1, 14228  (nrow, ncol, nlyr)</span></span>
<span><span class="co">#&gt; resolution  : 0.05, 0.05  (x, y)</span></span>
<span><span class="co">#&gt; extent      : 145.4, 145.45, -14.7, -14.65  (xmin, xmax, ymin, ymax)</span></span>
<span><span class="co">#&gt; coord. ref. : lon/lat WGS 84 (EPSG:4326) </span></span>
<span><span class="co">#&gt; source(s)   : memory</span></span>
<span><span class="co">#&gt; varname     : Daily SST climatology </span></span>
<span><span class="co">#&gt; names       : 1985-06-01, 1985-06-02, 1985-06-03, 1985-06-04, 1985-06-05, 1985-06-06, ... </span></span>
<span><span class="co">#&gt; min values  :   24.45509,   24.45509,   24.45509,   24.45509,   24.45509,   24.45509, ... </span></span>
<span><span class="co">#&gt; max values  :   24.45509,   24.45509,   24.45509,   24.45509,   24.45509,   24.45509, ... </span></span>
<span><span class="co">#&gt; time (days) : 1985-06-01 to 2024-05-15</span></span>
<span></span>
<span><span class="va">lizard_crw_climatology</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span>xy<span class="op">=</span><span class="cn">TRUE</span>, wide<span class="op">=</span><span class="cn">FALSE</span>, time<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>dc<span class="op">=</span><span class="va">values</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_path.html" class="external-link">geom_line</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span><span class="va">time</span>, <span class="va">dc</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="calculating_climatologies_files/figure-html/unnamed-chunk-7-1.png" width="700"></p>
</div>
<div class="section level4">
<h4 id="calculate-anomalies">calculate anomalies<a class="anchor" aria-label="anchor" href="#calculate-anomalies"></a>
</h4>
<p>the <code><a href="../reference/calculate_anomalies.html">calculate_anomalies()</a></code> function takes the sst file
and the daily climatologies and calculates the SST anomalies relative to
the baseline period. Following the methodology of Skirving et al
2020:</p>
<blockquote>
<p>The daily SST Anomaly product requires a daily climatology for
calculating the daily SST anomalies. The daily SST Anomaly product is
then calculated using</p>
<p><span class="math display">\[
\text{SST Anomaly}_i = \text{SST}_i - \text{DC}_d
\]</span> where i is the day of the anomaly and d is the day number
corresponding to i</p>
</blockquote>
<p>The function subtracts the daily climatologies from the input
sst_file to give the daily anomalies.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">lizard_crw_anomalies</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/calculate_anomalies.html">calculate_anomalies</a></span><span class="op">(</span>sst_file <span class="op">=</span> <span class="va">lizard_crw</span>, climatology <span class="op">=</span> <span class="va">lizard_crw_climatology</span><span class="op">)</span></span>
<span></span>
<span><span class="va">lizard_crw_anomalies</span></span>
<span><span class="co">#&gt; class       : SpatRaster </span></span>
<span><span class="co">#&gt; dimensions  : 1, 1, 14228  (nrow, ncol, nlyr)</span></span>
<span><span class="co">#&gt; resolution  : 0.05, 0.05  (x, y)</span></span>
<span><span class="co">#&gt; extent      : 145.4, 145.45, -14.7, -14.65  (xmin, xmax, ymin, ymax)</span></span>
<span><span class="co">#&gt; coord. ref. : lon/lat WGS 84 (EPSG:4326) </span></span>
<span><span class="co">#&gt; source(s)   : memory</span></span>
<span><span class="co">#&gt; varname     : SST Anomalies </span></span>
<span><span class="co">#&gt; names       : 1985-06-01, 1985-06-02, 1985-06-03, 1985-06-04, 1985-06-05, 1985-06-06, ... </span></span>
<span><span class="co">#&gt; min values  :  0.4349068,  0.7449082,  0.9049081,  0.8149079,  0.8249081,  0.2949074, ... </span></span>
<span><span class="co">#&gt; max values  :  0.4349068,  0.7449082,  0.9049081,  0.8149079,  0.8249081,  0.2949074, ... </span></span>
<span><span class="co">#&gt; time (days) : 1985-06-01 to 2024-05-15</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="calculate-hotspots">calculate hotspots<a class="anchor" aria-label="anchor" href="#calculate-hotspots"></a>
</h4>
<p>the <code><a href="../reference/calculate_hotspots.html">calculate_hotspots()</a></code> function takes the mean monthly
maximum function and the initial SST dataset and calculates the daily
hotspots. Following Skirving et al (2020):</p>
<blockquote>
<p>The HS is calculated as the diﬀerence between a day’s SST and the
MMM:</p>
<p><span class="math display">\[
\text HS_i = SST_i - MMM, \quad HS_i \geq 0
\]</span></p>
<p>Note that there is only one value of the MMM for a single pixel,
whereas the HS and corresponding SST vary on a daily basis. The HS is
always zero or positive, so when the calculation results in a negative
HS, it is set to zero.</p>
</blockquote>
<p>the function computes <strong>Coral Bleaching HotSpots (HS)</strong>
based on the difference between sea surface temperature (SST) data
(sst_file) and the <strong>Maximum Monthly Mean (MMM)</strong>
climatology (mmm). It begins by calculating the anomaly (anomaly_mmm),
which is the difference between the SST and MMM. The anomalies are
transformed into two hotspot rasters: hotspots_unset, where values below
0 are set to 0, and hotspots, where values below 1 are set to 0,
reflecting the threshold for meaningful heat stress. The function
ensures that time metadata and proper variable names are assigned to the
resulting rasters, and the final raster (hotspots) is returned,
containing daily hotspot values for the SST data aligned with the MMM
climatology.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">lizard_crw_hotspots</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/calculate_hotspots.html">calculate_hotspots</a></span><span class="op">(</span>mmm <span class="op">=</span> <span class="va">lizard_crw_mmm</span>, sst_file <span class="op">=</span> <span class="va">lizard_crw</span><span class="op">)</span></span>
<span></span>
<span><span class="va">lizard_crw_hotspots</span></span>
<span><span class="co">#&gt; class       : SpatRaster </span></span>
<span><span class="co">#&gt; dimensions  : 1, 1, 14228  (nrow, ncol, nlyr)</span></span>
<span><span class="co">#&gt; resolution  : 0.05, 0.05  (x, y)</span></span>
<span><span class="co">#&gt; extent      : 145.4, 145.45, -14.7, -14.65  (xmin, xmax, ymin, ymax)</span></span>
<span><span class="co">#&gt; coord. ref. : lon/lat WGS 84 (EPSG:4326) </span></span>
<span><span class="co">#&gt; source(s)   : memory</span></span>
<span><span class="co">#&gt; varname     : Hotspots </span></span>
<span><span class="co">#&gt; names       : 1985-06-01, 1985-06-02, 1985-06-03, 1985-06-04, 1985-06-05, 1985-06-06, ... </span></span>
<span><span class="co">#&gt; min values  :          0,          0,          0,          0,          0,          0, ... </span></span>
<span><span class="co">#&gt; max values  :          0,          0,          0,          0,          0,          0, ... </span></span>
<span><span class="co">#&gt; time (days) : 1985-06-01 to 2024-05-15</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="calculate-degree-heating-weeks">calculate degree heating weeks<a class="anchor" aria-label="anchor" href="#calculate-degree-heating-weeks"></a>
</h4>
<p>the <code><a href="../reference/calculate_dhw.html">calculate_dhw()</a></code> function takes the hotspots and a
specified window (by default 84 days, 12 weeks). Following Skirving et
al (2020):</p>
<blockquote>
<p>The DHW is the daily summation, over a 12-week (84 days) running
window, of HS values of 1 or more, expressed as degrees Celsius weeks
(◦C weeks), since the development of coral bleaching is usually on the
order of weeks. Each daily HS value, if included in the summation, is
divided by seven prior to being added to the total, such that</p>
<p><span class="math display">\[
\text{DHW}_i = \sum_{n = i-83}^{i} \left( \frac{\text{HS}_n}{7} \right),
\quad \text{where } \text{HS}_n \geq 1
\]</span></p>
<p>For example, if the 12-week window ending on June 1, 2014 (i= 1 June
2014), had included only four daily Coral Bleaching HotSpot values above
zero, of 1.0, 2.0, 0.8 and 1.2◦C, then, since 0.8◦C is less than 1◦C, it
would not be included in the DHW summation of accumulated heat stress
for this period. However, 1.0, 2.0, and 1.2◦C each would have been
divided by seven, and then summed. The resulting DHW value for 1 June
2014 (DHW1 June 2014) would have been 0.6◦C weeks.</p>
</blockquote>
<p>The function computes the Degree Heating Weeks (DHW) metric, which
accumulates heat stress over a specified rolling window (defaulting to
84 days). The function operates by applying a rolling sum on the input
hotspots raster data. For each pixel, if the daily hotspot values are
greater than or equal to 1, they are summed over the rolling window and
divided by 7 to calculate weekly averages using zoo::rollapply. The
function returns a raster object with the calculated DHW values, which
represent accumulated heat stress.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">lizard_crw_dhw</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/calculate_dhw.html">calculate_dhw</a></span><span class="op">(</span>hotspots <span class="op">=</span> <span class="va">lizard_crw_hotspots</span><span class="op">)</span></span>
<span></span>
<span><span class="va">lizard_crw_dhw</span></span>
<span><span class="co">#&gt; class       : SpatRaster </span></span>
<span><span class="co">#&gt; dimensions  : 1, 1, 14228  (nrow, ncol, nlyr)</span></span>
<span><span class="co">#&gt; resolution  : 0.05, 0.05  (x, y)</span></span>
<span><span class="co">#&gt; extent      : 145.4, 145.45, -14.7, -14.65  (xmin, xmax, ymin, ymax)</span></span>
<span><span class="co">#&gt; coord. ref. : lon/lat WGS 84 (EPSG:4326) </span></span>
<span><span class="co">#&gt; source(s)   : memory</span></span>
<span><span class="co">#&gt; varname     : Degree Heating Weeks </span></span>
<span><span class="co">#&gt; names       : 1985-06-01, 1985-06-02, 1985-06-03, 1985-06-04, 1985-06-05, 1985-06-06, ... </span></span>
<span><span class="co">#&gt; min values  :        NaN,        NaN,        NaN,        NaN,        NaN,        NaN, ... </span></span>
<span><span class="co">#&gt; max values  :        NaN,        NaN,        NaN,        NaN,        NaN,        NaN, ... </span></span>
<span><span class="co">#&gt; time (days) : 1985-06-01 to 2024-05-15</span></span></code></pre></div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://github.com/marine.ecologist/" class="external-link">George Roff</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
