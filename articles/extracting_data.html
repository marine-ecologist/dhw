<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Extracting SST and spatial data • dhw</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><script src="../deps/MathJax-3.2.2/tex-chtml.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Extracting SST and spatial data">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">dhw</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Released version">0.0.4</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><h6 class="dropdown-header" data-toc-skip>1. SST Metrics</h6></li>
    <li><a class="dropdown-item" href="../articles/calculating_climatologies.html">Calculating Degree Heating Weeks</a></li>
    <li><h6 class="dropdown-header" data-toc-skip>2. Reprocible Code</h6></li>
    <li><a class="dropdown-item" href="../articles/validating_climatologies.html">Validating DHW climatologies</a></li>
    <li><h6 class="dropdown-header" data-toc-skip>3. Extracting and visualising data</h6></li>
    <li><a class="dropdown-item" href="../articles/extracting_data.html">Downloading SST and spatial data</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch">
<li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul>
</li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Extracting SST and spatial data</h1>
            
      

      <div class="d-none name"><code>extracting_data.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://marine-ecologist.github.io/dhw/">dhw</a></span><span class="op">)</span></span>
<span><span class="co">#&gt;  library(dhw) dev v0.0.4</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-spatial.github.io/sf/" class="external-link">sf</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Linking to GEOS 3.10.2, GDAL 3.4.1, PROJ 8.2.1; sf_use_s2() is TRUE</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org" class="external-link">tidyverse</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Error in get(paste0(generic, ".", class), envir = get_method_env()) : </span></span>
<span><span class="co">#&gt;   object 'type_sum.accel' not found</span></span>
<span><span class="co">#&gt; ── <span style="font-weight: bold;">Attaching core tidyverse packages</span> ──────────────────────── tidyverse 2.0.0 ──</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">dplyr    </span> 1.1.4     <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">readr    </span> 2.1.5</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">forcats  </span> 1.0.0     <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">stringr  </span> 1.5.1</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">ggplot2  </span> 3.5.1     <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">tibble   </span> 3.2.1</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">lubridate</span> 1.9.4     <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">tidyr    </span> 1.3.1</span></span>
<span><span class="co">#&gt; <span style="color: #00BB00;">✔</span> <span style="color: #0000BB;">purrr    </span> 1.0.2</span></span>
<span><span class="co">#&gt; ── <span style="font-weight: bold;">Conflicts</span> ────────────────────────────────────────── tidyverse_conflicts() ──</span></span>
<span><span class="co">#&gt; <span style="color: #BB0000;">✖</span> <span style="color: #0000BB;">dplyr</span>::<span style="color: #00BB00;">filter()</span> masks <span style="color: #0000BB;">stats</span>::filter()</span></span>
<span><span class="co">#&gt; <span style="color: #BB0000;">✖</span> <span style="color: #0000BB;">dplyr</span>::<span style="color: #00BB00;">lag()</span>    masks <span style="color: #0000BB;">stats</span>::lag()</span></span>
<span><span class="co">#&gt; <span style="color: #00BBBB;">ℹ</span> Use the conflicted package (<span style="color: #0000BB; font-style: italic;">&lt;http://conflicted.r-lib.org/&gt;</span>) to force all conflicts to become errors</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://rspatial.org/" class="external-link">terra</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; terra 1.8.5</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'terra'</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; The following object is masked from 'package:tidyr':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     extract</span></span></code></pre></div>
<div class="section level3">
<h3 id="extract-gbr-spatial-data">Extract GBR spatial data<a class="anchor" aria-label="anchor" href="#extract-gbr-spatial-data"></a>
</h3>
<p>Use this function to download the GBR Reefs dataset via eAtlas.
Several versions of the GBRMPA shp file exist, this version from eAtlas
include the Torres Straits:</p>
<blockquote>
<p>This dataset consists of a shapefile of the reefs, islands, sand
banks, cays and rocks of the whole Great Barrier Reef (GBR) including
Torres Strait. This dataset is an extension of the mapping in the GBR
Marine Park to include Torres Strait. The Torres Strait region was
mapped at a scale of 1:50,000 (Lawrey, E. P., Stewart M., 2016) and
these new features are referred to as the “Torres Strait Reef and Island
Features” dataset. The Complete GBR Reef and Island Features dataset
integrates the “Torres Strait Reef and Island Features” dataset with the
existing “GBR Features” (Great Barrier Reef Marine Park Authority, 2007)
to create a single composite dataset of the whole Great Barrier
Reef.</p>
</blockquote>
<p>for metadata see here:</p>
<p><a href="https://researchdata.edu.au/complete-great-barrier-tsra-gbrmpa/675397" class="external-link">Complete
Great Barrier Reef (GBR) Island and Reef Feature boundaries including
Torres Strait Version 1b (NESP TWQ 3.13, AIMS, TSRA, GBRMPA)</a></p>
<p>The function returns either “hull” (convex hull around reefs), “base”
(basic with no changes), or “combined” (polygons merged to reef ID)</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co">#gbr_reefs &lt;- download_gbr_spatial(return="combined")</span></span>
<span><span class="va">gbr_reefs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/download_gbr_spatial.html">download_gbr_spatial</a></span><span class="op">(</span>return<span class="op">=</span><span class="st">"base"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Downloading spatial data...</span></span>
<span><span class="co">#&gt; Reading and transforming shapefile...</span></span>
<span></span>
<span><span class="va">gbr_reefs</span></span>
<span><span class="co">#&gt; Simple feature collection with 9612 features and 35 fields</span></span>
<span><span class="co">#&gt; Geometry type: POLYGON</span></span>
<span><span class="co">#&gt; Dimension:     XY</span></span>
<span><span class="co">#&gt; Bounding box:  xmin: 138.0012 ymin: -29.17855 xmax: 153.5516 ymax: -8.679173</span></span>
<span><span class="co">#&gt; Geodetic CRS:  GDA94</span></span>
<span><span class="co">#&gt; First 10 features:</span></span>
<span><span class="co">#&gt;    TARGET_FID     DATASET               LOC_NAME_S      GBR_NAME CHART_NAME</span></span>
<span><span class="co">#&gt; 1           1 TS Features  U/N Sand Bank (09-347a) U/N Sand Bank       &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 2           2 TS Features   U/N Sand Bank (09-347) U/N Sand Bank       &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 3           3 TS Features  U/N Sand Bank (09-355z) U/N Sand Bank       &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 4           4 TS Features U/N Sand Bank (09-355a0) U/N Sand Bank       &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 5           5 TS Features U/N Sand Bank (09-355a1) U/N Sand Bank       &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 6           6 TS Features  U/N Sand Bank (09-355v) U/N Sand Bank       &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 7           7 TS Features  U/N Sand Bank (09-355x) U/N Sand Bank       &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 8           8 TS Features  U/N Sand Bank (09-355y) U/N Sand Bank       &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 9           9 TS Features  U/N Sand Bank (09-355w) U/N Sand Bank       &lt;NA&gt;</span></span>
<span><span class="co">#&gt; 10         10 TS Features   U/N Sand Bank (09-373) U/N Sand Bank       &lt;NA&gt;</span></span>
<span><span class="co">#&gt;    TRAD_NAME UN_FEATURE LABEL_ID SORT_GBR_I FEAT_NAME LEVEL_1   LEVEL_2</span></span>
<span><span class="co">#&gt; 1       &lt;NA&gt;       TRUE  09-347a       9347      Bank    Bank Sand Bank</span></span>
<span><span class="co">#&gt; 2       &lt;NA&gt;       TRUE   09-347       9347      Bank    Bank Sand Bank</span></span>
<span><span class="co">#&gt; 3       &lt;NA&gt;       TRUE  09-355z       9355      Bank    Bank Sand Bank</span></span>
<span><span class="co">#&gt; 4       &lt;NA&gt;       TRUE 09-355a0       9355      Bank    Bank Sand Bank</span></span>
<span><span class="co">#&gt; 5       &lt;NA&gt;       TRUE 09-355a1       9355      Bank    Bank Sand Bank</span></span>
<span><span class="co">#&gt; 6       &lt;NA&gt;       TRUE  09-355v       9355      Bank    Bank Sand Bank</span></span>
<span><span class="co">#&gt; 7       &lt;NA&gt;       TRUE  09-355x       9355      Bank    Bank Sand Bank</span></span>
<span><span class="co">#&gt; 8       &lt;NA&gt;       TRUE  09-355y       9355      Bank    Bank Sand Bank</span></span>
<span><span class="co">#&gt; 9       &lt;NA&gt;       TRUE  09-355w       9355      Bank    Bank Sand Bank</span></span>
<span><span class="co">#&gt; 10      &lt;NA&gt;       TRUE   09-373       9373      Bank    Bank Sand Bank</span></span>
<span><span class="co">#&gt;      LEVEL_3 CLASS_CONF CLASS_SRC POLY_ORIG IMG_SRC SUB_NO           CODE</span></span>
<span><span class="co">#&gt; 1  Sand Bank       High   Landsat       New Landsat    101 09-347-110-101</span></span>
<span><span class="co">#&gt; 2  Sand Bank       High   Landsat       New Landsat    100 09-347-110-100</span></span>
<span><span class="co">#&gt; 3  Sand Bank       High   Landsat       New Landsat    126 09-355-110-126</span></span>
<span><span class="co">#&gt; 4  Sand Bank       High   Landsat       New Landsat    127 09-355-110-127</span></span>
<span><span class="co">#&gt; 5  Sand Bank       High   Landsat       New Landsat    128 09-355-110-128</span></span>
<span><span class="co">#&gt; 6  Sand Bank       High   Landsat       New Landsat    122 09-355-110-122</span></span>
<span><span class="co">#&gt; 7  Sand Bank       High   Landsat       New Landsat    124 09-355-110-124</span></span>
<span><span class="co">#&gt; 8  Sand Bank       High   Landsat       New Landsat    125 09-355-110-125</span></span>
<span><span class="co">#&gt; 9  Sand Bank       High   Landsat       New Landsat    123 09-355-110-123</span></span>
<span><span class="co">#&gt; 10 Sand Bank       High   Landsat       New Landsat    100 09-373-110-100</span></span>
<span><span class="co">#&gt;    FEATURE_C      QLD_NAME X_LABEL GBR_ID LOC_NAME_L  X_COORD   Y_COORD</span></span>
<span><span class="co">#&gt; 1        110 U/N Sand Bank    &lt;NA&gt;   &lt;NA&gt;       &lt;NA&gt; 143.0781 -9.270715</span></span>
<span><span class="co">#&gt; 2        110 U/N Sand Bank    &lt;NA&gt;   &lt;NA&gt;       &lt;NA&gt; 143.0429 -9.293290</span></span>
<span><span class="co">#&gt; 3        110 U/N Sand Bank    &lt;NA&gt;   &lt;NA&gt;       &lt;NA&gt; 143.1020 -9.388480</span></span>
<span><span class="co">#&gt; 4        110 U/N Sand Bank    &lt;NA&gt;   &lt;NA&gt;       &lt;NA&gt; 143.0973 -9.388562</span></span>
<span><span class="co">#&gt; 5        110 U/N Sand Bank    &lt;NA&gt;   &lt;NA&gt;       &lt;NA&gt; 143.0940 -9.390258</span></span>
<span><span class="co">#&gt; 6        110 U/N Sand Bank    &lt;NA&gt;   &lt;NA&gt;       &lt;NA&gt; 143.1209 -9.386653</span></span>
<span><span class="co">#&gt; 7        110 U/N Sand Bank    &lt;NA&gt;   &lt;NA&gt;       &lt;NA&gt; 143.0837 -9.393855</span></span>
<span><span class="co">#&gt; 8        110 U/N Sand Bank    &lt;NA&gt;   &lt;NA&gt;       &lt;NA&gt; 143.1636 -9.405083</span></span>
<span><span class="co">#&gt; 9        110 U/N Sand Bank    &lt;NA&gt;   &lt;NA&gt;       &lt;NA&gt; 143.0506 -9.404345</span></span>
<span><span class="co">#&gt; 10       110 U/N Sand Bank    &lt;NA&gt;   &lt;NA&gt;       &lt;NA&gt; 142.9252 -9.756551</span></span>
<span><span class="co">#&gt;    SHAPE_AREA  SHAPE_LEN Checked RegionID LatitudeID GroupID PriorityLb</span></span>
<span><span class="co">#&gt; 1  0.78616854 10.4794306   FALSE       13          9     347      FALSE</span></span>
<span><span class="co">#&gt; 2  2.95336187 17.8452808   FALSE       13          9     347       TRUE</span></span>
<span><span class="co">#&gt; 3  0.17314345  2.0730203   FALSE       13          9     355      FALSE</span></span>
<span><span class="co">#&gt; 4  0.05753826  1.0656155   FALSE       13          9     355      FALSE</span></span>
<span><span class="co">#&gt; 5  0.03254316  0.7397521   FALSE       13          9     355      FALSE</span></span>
<span><span class="co">#&gt; 6  3.57375838 16.4615152   FALSE       13          9     355      FALSE</span></span>
<span><span class="co">#&gt; 7  0.88188514  7.8675980   FALSE       13          9     355      FALSE</span></span>
<span><span class="co">#&gt; 8  0.32171390  2.9717605   FALSE       13          9     355      FALSE</span></span>
<span><span class="co">#&gt; 9  1.52979291 14.3151950   FALSE       13          9     355      FALSE</span></span>
<span><span class="co">#&gt; 10 1.65930929  9.6393642   FALSE       14          9     373       TRUE</span></span>
<span><span class="co">#&gt;             Country   UNIQUE_ID                       geometry</span></span>
<span><span class="co">#&gt; 1  Papua-New Guinea 09347110101 POLYGON ((143.0851 -9.26657...</span></span>
<span><span class="co">#&gt; 2  Papua-New Guinea 09347110100 POLYGON ((143.0549 -9.29339...</span></span>
<span><span class="co">#&gt; 3  Papua-New Guinea 09355110126 POLYGON ((143.1056 -9.3908,...</span></span>
<span><span class="co">#&gt; 4  Papua-New Guinea 09355110127 POLYGON ((143.0985 -9.39007...</span></span>
<span><span class="co">#&gt; 5  Papua-New Guinea 09355110128 POLYGON ((143.0939 -9.39146...</span></span>
<span><span class="co">#&gt; 6  Papua-New Guinea 09355110122 POLYGON ((143.1298 -9.36866...</span></span>
<span><span class="co">#&gt; 7  Papua-New Guinea 09355110124 POLYGON ((143.0905 -9.38934...</span></span>
<span><span class="co">#&gt; 8  Papua-New Guinea 09355110125 POLYGON ((143.1675 -9.40401...</span></span>
<span><span class="co">#&gt; 9  Papua-New Guinea 09355110123 POLYGON ((143.0739 -9.39021...</span></span>
<span><span class="co">#&gt; 10        Australia 09373110100 POLYGON ((142.9353 -9.77388...</span></span>
<span></span>
<span><span class="va">GBR_hull</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/download_gbr_spatial.html">download_gbr_spatial</a></span><span class="op">(</span>return<span class="op">=</span><span class="st">"hull"</span>, crs <span class="op">=</span> <span class="st">"EPSG:7844"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Downloading spatial data...</span></span>
<span><span class="co">#&gt; Reading and transforming shapefile...</span></span></code></pre></div>
<p>Set up a boundary to mask the raster data by buffering a 1km concave
hull surrounding the GBR Reefs:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">gbr_reefs_border</span> <span class="op">&lt;-</span> <span class="va">gbr_reefs</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/valid.html" class="external-link">st_make_valid</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">FEAT_NAME</span> <span class="op"><a href="https://rspatial.github.io/terra/reference/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Reef"</span>, <span class="st">"Terrestrial Reef"</span><span class="op">)</span><span class="op">)</span> </span>
<span></span>
<span><span class="va">gbr_reefs_hull</span> <span class="op">&lt;-</span> <span class="va">gbr_reefs_border</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu">concaveman</span><span class="fu">::</span><span class="fu"><a href="https://joelgombin.github.io/concaveman/reference/concaveman.html" class="external-link">concaveman</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/valid.html" class="external-link">st_make_valid</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">gbr_reefs_hull_buffered</span> <span class="op">&lt;-</span> <span class="va">gbr_reefs_hull</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://r-spatial.github.io/sf/reference/geos_unary.html" class="external-link">st_buffer</a></span><span class="op">(</span><span class="fl">1000</span><span class="op">)</span> </span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_bw</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">gbr_reefs_hull_buffered</span>,  fill<span class="op">=</span><span class="st">"turquoise3"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">gbr_reefs_hull</span>, fill<span class="op">=</span><span class="st">"lightblue"</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data<span class="op">=</span><span class="va">gbr_reefs_border</span>, fill<span class="op">=</span><span class="st">"black"</span><span class="op">)</span> </span></code></pre></div>
<p><img src="extracting_data_files/figure-html/unnamed-chunk-4-1.png" width="672"></p>
</div>
<div class="section level3">
<h3 id="downloading-and-extracting-sst-data">Downloading and extracting SST data<a class="anchor" aria-label="anchor" href="#downloading-and-extracting-sst-data"></a>
</h3>
<p>NOAA provide many options for downloading SST data. <a href="https://www.ncei.noaa.gov/erddap/" class="external-link">ERDAPP</a> via the
<code>rerdapp</code> library is very useful for smaller requests, but
(in my experience) downloading long-time series or large spatial extents
of data can result in signficant timeouts.</p>
<p>Below are three helper functions that directly download CRW, OISST,
and ERA5 datasets at global scales:</p>
<div class="section level4">
<h4 id="extract-noaa-coraltemp-spatial-data">Extract NOAA CoralTemp spatial data<a class="anchor" aria-label="anchor" href="#extract-noaa-coraltemp-spatial-data"></a>
</h4>
<p><code><a href="../reference/download_CoralTemp.html">download_CoralTemp()</a></code> pulls global data from the
<code>ncei</code> https as follows:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span></span>
<span></span>
<span><span class="fu"><a href="../reference/download_CoralTemp.html">download_CoralTemp</a></span><span class="op">(</span>url <span class="op">=</span> <span class="st">"https://www.ncei.noaa.gov/thredds-ocean/fileServer/crw/5km/v3.1/nc/v1.0/daily/"</span>,</span>
<span>                   start_date <span class="op">=</span> <span class="st">"2024-01-01"</span>,</span>
<span>                   end_date <span class="op">=</span> <span class="st">"2024-12-31"</span>,</span>
<span>                   dest_dir <span class="op">=</span> <span class="st">"/Volumes/Extreme_SSD/dhw/CRW/2024/"</span>,</span>
<span>                   variable <span class="op">=</span> <span class="st">"sst"</span>,</span>
<span>                   mc.cores <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="fu"><a href="../reference/download_CoralTemp.html">download_CoralTemp</a></span><span class="op">(</span>url <span class="op">=</span> <span class="st">"https://www.ncei.noaa.gov/thredds-ocean/fileServer/crw/5km/v3.1/nc/v1.0/daily/"</span>,</span>
<span>                   start_date <span class="op">=</span> <span class="st">"2024-01-01"</span>,</span>
<span>                   end_date <span class="op">=</span> <span class="st">"2024-12-31"</span>,</span>
<span>                   dest_dir <span class="op">=</span> <span class="st">"/Volumes/Extreme_SSD/dhw/CRW/2024/"</span>,</span>
<span>                   variable <span class="op">=</span> <span class="st">"dhw"</span>,</span>
<span>                   mc.cores <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p>the full global dataset for four variables (sst, ssta, hs, dhw) is
520.78GB in individual ~10-11MB .nc files.</p>
<p><code>process_CoralTemp</code> does three functions: 1) crop-mask to
a polygon shape (here the GBR hull), 2) combine <code>rast</code> files
using <code><a href="https://rdrr.io/r/base/c.html" class="external-link">c()</a></code>, 3) output to an <code>.rds</code> file for
saving. The function will be paralellised (later) as it is
<em>slow</em></p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="../reference/process_CoralTemp.html">process_CoralTemp</a></span><span class="op">(</span>input <span class="op">=</span> <span class="st">"/Volumes/Extreme_SSD/dhw/CRW/CRW_SST"</span>,</span>
<span>                  polygon <span class="op">=</span> <span class="va">GBR_hull</span>, crs <span class="op">=</span> <span class="st">"EPSG:7844"</span>,</span>
<span>                  combinedfilename <span class="op">=</span> <span class="st">"/Volumes/Extreme_SSD/dhw/summaries/GBR_CoralTemp_full.rds"</span>,</span>
<span>                  crop<span class="op">=</span><span class="cn">TRUE</span>, mask<span class="op">=</span><span class="cn">TRUE</span>, downsample<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">GBR_CoralTemp_full</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rspatial.github.io/terra/reference/serialize.html" class="external-link">readRDS</a></span><span class="op">(</span> <span class="st">"/Volumes/Extreme_SSD/dhw/summaries/GBR_CoralTemp_full.rds"</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="fu"><a href="../reference/process_CoralTemp.html">process_CoralTemp</a></span><span class="op">(</span>input <span class="op">=</span> <span class="st">"/Volumes/Extreme_SSD/dhw/CRW/CRW_DHW"</span>,</span>
<span>                  polygon <span class="op">=</span> <span class="va">GBR_hull</span>, crs <span class="op">=</span> <span class="st">"EPSG:7844"</span>,</span>
<span>                  combinedfilename <span class="op">=</span> <span class="st">"/Volumes/Extreme_SSD/dhw/summaries/GBR_CoralTemp_DHW_full.rds"</span>,</span>
<span>                  crop<span class="op">=</span><span class="cn">TRUE</span>, mask<span class="op">=</span><span class="cn">TRUE</span>, downsample<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p>Alternatively, <code>cdo</code> offers a much faster workflow using
<code>cdo mergetime *.nc outfile</code> and cropped to the GBR extent
using<code>remapbil,target_grid_file.nc input.nc regridded_output.nc</code>
(note: CDO does not directly support cropping to irregular polygons, so
remapbil sets to the extent (bbox).</p>
</div>
<div class="section level4">
<h4 id="extract-oisst">Extract OISST<a class="anchor" aria-label="anchor" href="#extract-oisst"></a>
</h4>
<p><code><a href="../reference/download_OISST.html">download_OISST()</a></code> pulls global data from the
<code>ncei</code> https as follows:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="../reference/download_OISST.html">download_OISST</a></span><span class="op">(</span>url <span class="op">=</span> <span class="st">"https://www.ncei.noaa.gov/data/sea-surface-temperature-optimum-interpolation/v2.1/access/avhrr/"</span>,</span>
<span>               start_date <span class="op">=</span> <span class="st">"2024-12-15"</span>,</span>
<span>               end_date <span class="op">=</span> <span class="st">"2024-12-15"</span>,</span>
<span>               dest_dir <span class="op">=</span> <span class="st">"/Volumes/Extreme_SSD/dhw/OISST/2024/"</span>,</span>
<span>               mc.cores <span class="op">=</span> <span class="fl">12</span><span class="op">)</span></span></code></pre></div>
<p>the full global dataset is 26.39GB in individual ~10-11MB .nc
files.</p>
<p><code>process_OISST</code> does three functions: 1) crop-mask to a
polygon shape (here the GBR hull), 2) combine <code>rast</code> files
using <code><a href="https://rdrr.io/r/base/c.html" class="external-link">c()</a></code>, 3) output to an <code>.rds</code> file for
saving. The function will be paralellised (later) as it is
<em>slow</em></p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="../reference/process_OISST.html">process_OISST</a></span><span class="op">(</span>input <span class="op">=</span> <span class="st">"/Volumes/Extreme_SSD/dhw/OISST/"</span>,</span>
<span>              polygon <span class="op">=</span> <span class="va">GBR_hull</span>, crs <span class="op">=</span> <span class="st">"EPSG:7844"</span>,</span>
<span>              combinedfilename <span class="op">=</span> <span class="st">"/Volumes/Extreme_SSD/dhw/summaries/GBR_OISST_full.rds"</span>,</span>
<span>              crop<span class="op">=</span><span class="cn">TRUE</span>, mask<span class="op">=</span><span class="cn">TRUE</span>, downsample<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="st">"/Volumes/Extreme_SSD/dhw/summaries/GBR_OISST_full.rds"</span><span class="op">)</span></span>
<span>  </span></code></pre></div>
<p>Alternatively, <code>cdo</code> offers a much faster workflow using
<code>cdo mergetime *.nc outfile</code> and cropped to the GBR extent
using<code>remapbil,target_grid_file.nc input.nc regridded_output.nc</code>
(note: CDO does not directly support cropping to irregular polygons, so
remapbil sets to the extent (bbox).</p>
</div>
<div class="section level4">
<h4 id="extract-era5">Extract ERA5<a class="anchor" aria-label="anchor" href="#extract-era5"></a>
</h4>
<p>ERA5 doesn’t have a direct <code>https</code> link as far as I’m
aware. The <code><a href="../reference/download_ERA5.html">download_ERA5()</a></code> function uses the
<code>ecmwfr</code> interface to ‘ECMWF’ and ‘CDS’ Data Web Services to
access the daily SST data via <a href="https://cds.climate.copernicus.eu/datasets/reanalysis-era5-single-levels" class="external-link">Copernicus</a>.
Once downloaded, the <code><a href="../reference/process_ERA5.html">process_ERA5()</a></code> function combines the
outputs to a single <code>rast</code> file.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="../reference/download_ERA5.html">download_ERA5</a></span><span class="op">(</span></span>
<span>    start_year <span class="op">=</span> <span class="fl">1940</span>,</span>
<span>    end_year <span class="op">=</span> <span class="fl">2024</span>,</span>
<span>    ecmwfr_key <span class="op">=</span> <span class="st">"381246a1-68c9-4e99-aab2-44c36d6da73d"</span>,</span>
<span>    timeout<span class="op">=</span><span class="fl">60</span>,</span>
<span>    dest_dir <span class="op">=</span> <span class="st">"/Volumes/Extreme_SSD/dhw/ERA5/"</span></span>
<span>  <span class="op">)</span></span>
<span>  </span>
<span>  </span>
<span></span>
<span><span class="fu"><a href="../reference/process_ERA5.html">process_ERA5</a></span><span class="op">(</span>input <span class="op">=</span> <span class="st">"/Volumes/Extreme_SSD/dhw/ERA5/"</span>, units <span class="op">=</span> <span class="st">"celsius"</span>,</span>
<span>              polygon <span class="op">=</span> <span class="va">GBR_hull</span>, crs <span class="op">=</span> <span class="st">"EPSG:7844"</span>,</span>
<span>              combinedfilename <span class="op">=</span> <span class="st">"/Volumes/Extreme_SSD/dhw/summaries/GBR_ERA5_full.rds"</span>,</span>
<span>              crop<span class="op">=</span><span class="cn">TRUE</span>, mask<span class="op">=</span><span class="cn">TRUE</span>, downsample<span class="op">=</span><span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span><span class="st">"/Volumes/Extreme_SSD/dhw/summaries/GBR_ERA5_full.rds"</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by <a href="https://github.com/marine.ecologist/" class="external-link">George Roff</a>.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
